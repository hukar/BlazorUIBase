@page "/robot/add"
@using Blazored.FluentValidation

<MudText Class="my-6" Typo="Typo.h3" Color="Color.Secondary">RobotForm : Create Mode</MudText>

@*<EditForm Model="@Robot" OnValidSubmit="@ValidSubmitHandle" OnInvalidSubmit="@InvalidSubmitHandle">*@
<EditForm Model="@Robot" OnSubmit="SubmitFormAsync">
    <FluentValidationValidator @ref="_fluentValidationValidator"/>

    <MudGrid>
        <MudItem xs="12" sm="6">
            <MudCard>
                <MudCardContent>
                    <MudTextField
                        @bind-Value="@Robot.CodeName"
                        Label="CodeName"
                        Variant="Variant.Text"
                        For="() => Robot.CodeName"/>
                    @if (_weapons is not null)
                    {
                        <MudSelect
                            Label="Favourite Weapons"
                            @bind-Value="@Robot.FavouriteWeapon"
                            AnchorOrigin="Origin.BottomCenter"
                            For="() => Robot.FavouriteWeapon">
                            <MudSelectItem Value="@(new Weapon() { Id = 99, Name = "TUR-99" })">
                                <img src="images/weapons/weapon-99.png" height="14" class="mr-1"/> TUR-99
                            </MudSelectItem>
                            <MudSelectItem Value="@(new Weapon() { Id = 17, Name = "Michel Drucker" })">
                                <img src="images/weapons/weapon-99.png" height="14" class="mr-1"/> Michel Drucker
                            </MudSelectItem>
                            @foreach (var weapon in _weapons)
                            {
                                <MudSelectItem Value="@weapon">
                                    <img src="@($"images/weapons/weapon-{weapon.Id}.png")" height="14" class="mr-1"/> @weapon.Name
                                </MudSelectItem>
                            }
                        </MudSelect>
                    }
                    @*@if (_weapons is not null)
                    {
                        <MudSelect
                            Label="List Secondary Weapons"
                            MultiSelection="true"
                            @bind-SelectedValues="@Robot.Weapons"
                            For="() => Robot.Weapons">
                            <MudSelectItem Value="@(new Weapon() { Id = 98, Name = "TUR-98" })">
                                <img src="images/weapons/weapon-99.png" height="14" class="mr-1"/> TUR-98
                            </MudSelectItem>
                            <MudSelectItem Value="@(new Weapon() { Id = 99, Name = "TUR-99" })">
                                <img src="images/weapons/weapon-99.png" height="14" class="mr-1"/> TUR-99
                            </MudSelectItem>
                            @foreach (var weapon in _weapons)
                            {
                                <MudSelectItem Value="@weapon">
                                    <img src="@($"images/weapons/weapon-{weapon.Id}.png")" height="14" class="mr-1"/> @weapon.Name
                                </MudSelectItem>
                            }
                        </MudSelect>@
                    }*@
                </MudCardContent>
                <MudCardActions>
                    <MudButton
                        Variant="Variant.Filled"
                        ButtonType="ButtonType.Submit"
                        Color="Color.Secondary">
                        Add Robot
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>
        <MudItem xs="12" sm="6">
            <MudPaper Elevation="2" Class="mud-height-full pa-4">
                <MudText Typo="Typo.h6">Validation Summary</MudText>
                @if (_isSuccess)
                {
                    <MudText Typo="Typo.body1" Color="Color.Success">Validation is successfull</MudText>
                }
                else
                {
                    <MudText Color="Color.Error">
                        <ValidationSummary/>
                    </MudText>
                }
            </MudPaper>
        </MudItem>
        <MudItem xs="12">
            <MudPaper Elevation="2" Class="pa-8 mt-4">
                @if (Robot.Weapons is not null)
                {
                    @foreach (var weapon in Robot.Weapons)
                    {
                        <MudText Typo="Typo.body1">@weapon.Name</MudText>
                    }
                }
            </MudPaper>
        </MudItem>
    </MudGrid>
</EditForm>

@code {

    // TODO: formulaire weapon dans formulaire Robot pour ajouter de nouvelles armes dynamiquement

}

